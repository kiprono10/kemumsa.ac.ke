<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members | KeMUMSA</title>
    <link rel="icon" href="outsourced-media/Logo.png" type="image/png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&family=Playfair+Display:wght@700;800&family=Raleway:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Flaticon -->
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.1.0/uicons-thin-straight/css/uicons-thin-straight.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/mobile.css">

    <style>
        /* ===== MEMBERS PAGE STYLES ===== */

        .members-page-header {
            background: linear-gradient(135deg, #871054 0%, #a83b6e 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .members-page-header .header-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .members-page-header .page-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: white;
        }

        .members-page-header .page-subtitle {
            font-size: 1.1rem;
            opacity: 1;
            color: white;
        }

        /* Quick Stats */
        .members-quick-stats {
            background: white;
            padding: 2rem;
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .stats-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #871054;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.25rem;
        }

        .stat-divider {
            width: 1px;
            height: 40px;
            background: #ddd;
        }

        /* Discovery Section */
        .members-discovery {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .discovery-container {
            width: 100%;
        }

        /* Search Bar */
        .members-search-bar {
            margin-bottom: 2rem;
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-wrapper i {
            position: absolute;
            left: 1rem;
            color: #999;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 2.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #871054;
            box-shadow: 0 0 0 3px rgba(135, 16, 84, 0.1);
        }

        /* Filter Tabs */
        .members-filter-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .filter-tab {
            padding: 0.6rem 1.2rem;
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            white-space: nowrap;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-tab:hover {
            border-color: #871054;
            color: #871054;
        }

        .filter-tab.active {
            background: #871054;
            color: white;
            border-color: #871054;
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .view-btn {
            padding: 0.6rem 1rem;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn:hover, .view-btn.active {
            border-color: #871054;
            color: #871054;
        }

        /* Members Display */
        .members-display {
            min-height: 300px;
        }

        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        /* Modern Member Card */
        .modern-member-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            border: 1px solid #f0f0f0;
        }

        .modern-member-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(135, 16, 84, 0.12);
        }

        .member-card-header {
            position: relative;
            margin-bottom: 1rem;
        }

        .member-avatar-large {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #f0f0f0;
            background: linear-gradient(135deg, #871054, #c41a7b);
        }

        .member-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-initials {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 700;
        }

        .member-status-badge {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            position: absolute;
            bottom: 10px;
            right: 10px;
            border: 3px solid white;
            background: #999;
        }

        .member-status-badge.online {
            background: #28a745;
        }

        .member-status-badge.away {
            background: #ffc107;
        }

        .member-card-content {
            text-align: center;
        }

        .member-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 0.5rem;
            color: #333;
        }

        .member-year-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: rgba(135, 16, 84, 0.1);
            color: #871054;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 0 0 0.5rem;
        }

        .member-department {
            color: #666;
            font-size: 0.9rem;
            margin: 0 0 0.75rem;
        }

        .member-interests-list {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 0.75rem 0;
        }

        .member-interest {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #f0f0f0;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #666;
        }

        .member-card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .card-action-btn {
            flex: 1;
            padding: 0.6rem 0.5rem;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
        }

        .card-action-btn:hover {
            background: #871054;
            color: white;
            border-color: #871054;
        }

        /* No Results */
        .no-results-state {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        .no-results-state i {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 1rem;
        }

        .no-results-state h3 {
            color: #333;
            margin: 0 0 0.5rem;
        }

        .no-results-state p {
            color: #999;
            margin: 0 0 1.5rem;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #871054;
            color: white;
        }

        .btn-primary:hover {
            background: #6d0a41;
        }

        /* Class Leaders */
        .class-leaders-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 60px;
            background: white;
        }

        .leaders-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-top: 40px;
        }

        .leaders-header .section-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .leaders-header .section-subtitle {
            color: #666;
            font-size: 1rem;
        }

        .leaders-year-filter {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .class-filter-select {
            padding: 0.6rem 1.2rem;
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .class-filter-select:hover, .class-filter-select:focus {
            border-color: #871054;
            color: #871054;
            outline: none;
        }

        .class-leaders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        .class-leader-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            border: 1px solid #f0f0f0;
        }

        .class-leader-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(135, 16, 84, 0.12);
        }

        .leader-image {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid #f0f0f0;
            background: linear-gradient(135deg, #871054, #c41a7b);
        }

        .leader-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .leader-avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #871054, #c41a7b);
            color: white;
            font-size: 2rem;
        }

        .leader-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 0.5rem;
            color: #333;
        }

        .leader-position {
            color: #871054;
            font-weight: 600;
            margin: 0 0 0.75rem;
            font-size: 0.95rem;
        }

        .leader-year {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #999;
            grid-column: 1 / -1;
        }

        .loading-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .members-page-header .page-title {
                font-size: 1.8rem;
            }

            .members-page-header .page-subtitle {
                font-size: 0.95rem;
            }

            .stats-wrapper {
                gap: 1.5rem;
            }

            .stat-number {
                font-size: 2rem;
            }

            .stat-divider {
                display: none;
            }

            .members-filter-tabs {
                gap: 0.5rem;
            }

            .filter-tab {
                padding: 0.5rem 0.9rem;
                font-size: 0.85rem;
            }

            .members-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }

            .modern-member-card {
                padding: 1rem;
            }

            .member-avatar-large {
                width: 80px;
                height: 80px;
                margin: 0 auto 0.75rem;
            }

            .member-name {
                font-size: 1rem;
            }

            .card-action-btn {
                font-size: 0.75rem;
                padding: 0.5rem 0.3rem;
            }

            .class-leaders-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 1rem;
            }

            .class-leader-card {
                padding: 1.5rem 1rem;
            }

            .leader-image {
                width: 100px;
                height: 100px;
            }

            .leader-name {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .members-page-header {
                padding: 40px 15px;
            }

            .members-page-header .page-title {
                font-size: 1.5rem;
            }

            .members-page-header .page-subtitle {
                font-size: 0.85rem;
            }

            .members-quick-stats {
                padding: 1.5rem 15px;
            }

            .stats-wrapper {
                gap: 1rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.75rem;
            }

            .members-discovery {
                padding: 20px 15px;
            }

            .members-filter-tabs {
                gap: 0.4rem;
                margin-bottom: 1.5rem;
            }

            .filter-tab {
                padding: 0.4rem 0.7rem;
                font-size: 0.75rem;
            }

            .members-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .modern-member-card {
                padding: 0.75rem;
            }

            .member-avatar-large {
                width: 70px;
                height: 70px;
            }

            .member-name {
                font-size: 0.9rem;
            }

            .card-action-btn {
                font-size: 0.7rem;
                padding: 0.4rem 0.2rem;
            }

            .class-leaders-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .class-leader-card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-container">
            <!-- Logo -->
            <div class="logo-area">
                <div class="logo-icon">
                    <img src="outsourced-media/Logo.png" alt="KeMUMSA Logo" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                </div>
                <div class="logo-text">
                    <h1 class="association-name">KeMUMSA</h1>
                    <p class="association-full">Kenya Methodist University<br>Medical Students Association</p>
                </div>
            </div>

            <!-- Desktop Nav -->
            <nav class="desktop-nav">
                <ul class="nav-menu">
                    <li><a href="index.html"><i class="fi fi-ts-home"></i> Home</a></li>
                    <li><a href="about.html"><i class="fi fi-ts-info"></i> About</a></li>
                    <li><a href="events.html"><i class="fi fi-ts-calendar"></i> Events</a></li>
                    <li><a href="members.html" class="active"><i class="fi fi-ts-users"></i> Members</a></li>
                    <li><a href="contact.html"><i class="fi fi-ts-phone-call"></i> Contact</a></li>
                </ul>
            </nav>

            <!-- Header Actions -->
            <div class="header-actions">
                <button class="btn-login"><i class="fi fi-ts-user"></i> Login</button>
                <button class="btn-join">Join Now</button>
                <div class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <section class="members-page-header">
            <div class="header-content">
                <h1 class="page-title">Member Directory</h1>
                <p class="page-subtitle">Explore our vibrant community of medical students</p>
            </div>
        </section>

        <!-- Quick Stats -->
        <section class="members-quick-stats">
            <div class="stats-wrapper">
                <div class="stat-item">
                    <span class="stat-number" id="totalMembersValue">0</span>
                    <span class="stat-label">Members</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <span class="stat-number" id="visibleMembersValue">0</span>
                    <span class="stat-label">Public Profiles</span>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <span class="stat-number" id="yearGroupsValue">6</span>
                    <span class="stat-label">Year Groups</span>
                </div>
            </div>
        </section>

        <!-- Member Discovery Section -->
        <section class="members-discovery">
            <div class="discovery-container">
                <!-- Search Bar -->
                <div class="members-search-bar">
                    <div class="search-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search by name, role, interests..." class="search-input" id="memberSearch">
                    </div>
                </div>

                <!-- Filter Tabs -->
                <div class="members-filter-tabs">
                    <button class="filter-tab active" data-filter="all">
                        <i class="fas fa-th-large"></i>
                        <span>All</span>
                    </button>
                    <button class="filter-tab" data-filter="1">
                        <i class="fas fa-bookmark"></i>
                        <span>1st Year</span>
                    </button>
                    <button class="filter-tab" data-filter="2">
                        <i class="fas fa-bookmark"></i>
                        <span>2nd Year</span>
                    </button>
                    <button class="filter-tab" data-filter="3">
                        <i class="fas fa-bookmark"></i>
                        <span>3rd Year</span>
                    </button>
                    <button class="filter-tab" data-filter="4">
                        <i class="fas fa-bookmark"></i>
                        <span>4th Year</span>
                    </button>
                    <button class="filter-tab" data-filter="5">
                        <i class="fas fa-bookmark"></i>
                        <span>5th Year</span>
                    </button>
                    <button class="filter-tab" data-filter="6">
                        <i class="fas fa-bookmark"></i>
                        <span>6th Year</span>
                    </button>
                    <button class="filter-tab" data-filter="alumni">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Alumni</span>
                    </button>
                </div>

                <!-- Members Display -->
                <div class="members-display" id="membersDisplay">
                    <div class="members-grid" id="membersGrid">
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading members...</p>
                        </div>
                    </div>
                </div>

                <!-- No Results State -->
                <div class="no-results-state" id="noResultsState" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>No members found</h3>
                    <p>Try adjusting your search or filters</p>
                    <button class="btn btn-primary" onclick="resetFilters()">Reset Filters</button>
                </div>
            </div>
        </section>

        <!-- Class Leaders Section -->
        <section class="class-leaders-section">
            <div class="leaders-container">
                <div class="leaders-header">
                    <h2 class="section-title">Class Leaders</h2>
                    <p class="section-subtitle">Your year's leadership team</p>
                </div>

                <div class="leaders-year-filter">
                    <select class="class-filter-select" id="classLeadersYearFilter">
                        <option value="all">All Years</option>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                        <option value="5">5th Year</option>
                        <option value="6">6th Year</option>
                    </select>
                </div>

                <div class="class-leaders-grid" id="classLeadersGrid">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading class leaders...</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fi fi-ts-home"></i>
            <span>Home</span>
        </a>
        <a href="events.html" class="nav-item">
            <i class="fi fi-ts-calendar"></i>
            <span>Events</span>
        </a>
        <a href="members.html" class="nav-item active">
            <i class="fi fi-ts-users"></i>
            <span>Members</span>
        </a>
        <a href="contact.html" class="nav-item">
            <i class="fi fi-ts-chat"></i>
            <span>Chat</span>
        </a>
        <a href="about.html" class="nav-item">
            <i class="fi fi-ts-info"></i>
            <span>About</span>
        </a>
    </nav>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>KeMUMSA</h3>
                <p>Kenya Methodist University Medical Students Association</p>
                <div class="social-links" id="footerSocialLinks">
                    <!-- Social links will be loaded here -->
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="events.html">Events Calendar</a></li>
                    <li><a href="#">Resources</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Contact Info</h3>
                <ul class="contact-info">
                    <li><i class="fi fi-ts-marker"></i> Kenya Methodist University, Meru</li>
                    <li><i class="fi fi-ts-envelope"></i> kemumsa@kemu.ac.ke</li>
                    <li><i class="fi fi-ts-phone"></i> +254 712 345 678</li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2026 KeMUMSA. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="assets/css/js/main.js"></script>
    
    <script>
        // Global state
        let allMembers = [];
        let currentFilterYear = 'all';

        // ===== MEMBER LOADING =====
        async function fetchMembers() {
            try {
                const response = await fetch('/api/members');
                if (!response.ok) throw new Error('Failed to fetch members');
                const data = await response.json();
                allMembers = data.members || [];
                updateStats();
                renderMembers();
            } catch (error) {
                console.error('Error fetching members:', error);
                showNoResults();
            }
        }

        // ===== MEMBER RENDERING =====
        function renderMembers(membersToDisplay = null) {
            const container = document.getElementById('membersGrid');
            const members = membersToDisplay || getVisibleMembers();

            if (members.length === 0) {
                container.innerHTML = '';
                document.getElementById('noResultsState').style.display = 'flex';
                return;
            }

            document.getElementById('noResultsState').style.display = 'none';
            container.innerHTML = members.map(member => {
                const initials = ((member.firstName || 'M')[0] + (member.lastName || 'U')[0]).toUpperCase();
                const year = getOrdinalSuffix(member.yearOfStudy);
                const interests = member.interests?.slice(0, 2).map(i => `<span class="member-interest">${i}</span>`).join('') || '';

                return `
                    <div class="modern-member-card">
                        <div class="member-card-header">
                            <div class="member-avatar-large">
                                ${member.profilePicture ? 
                                    `<img src="${member.profilePicture}" alt="${member.firstName}">` :
                                    `<div class="avatar-initials">${initials}</div>`
                                }
                            </div>
                            <div class="member-status-badge ${member.status || 'offline'}"></div>
                        </div>
                        
                        <div class="member-card-content">
                            <h3 class="member-name">${member.firstName} ${member.lastName}</h3>
                            <p class="member-year-badge">${member.yearOfStudy}${year} Year</p>
                            <p class="member-department">${member.department || 'Medicine'}</p>
                            
                            ${interests ? `<div class="member-interests-list">${interests}</div>` : ''}
                            
                            <div class="member-card-actions">
                                <button class="card-action-btn" onclick="viewProfile('${member._id}')">
                                    <i class="fas fa-user-circle"></i> View
                                </button>
                                <button class="card-action-btn" onclick="messageUser('${member._id}')">
                                    <i class="fas fa-envelope"></i> Message
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== STATS UPDATE =====
        function updateStats() {
            const total = allMembers.length;
            const visible = getVisibleMembers().length;
            const years = new Set(getVisibleMembers().map(m => m.yearOfStudy)).size;

            animateNumber('totalMembersValue', total);
            animateNumber('visibleMembersValue', visible);
            document.getElementById('yearGroupsValue').textContent = years || 6;
        }

        function animateNumber(elementId, endValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            const startValue = parseInt(element.textContent) || 0;
            if (isNaN(endValue) || endValue === 0) {
                element.textContent = '0';
                return;
            }
            const duration = 600;
            const steps = 30;
            const increment = (endValue - startValue) / steps;
            let current = startValue;
            let step = 0;

            const timer = setInterval(() => {
                current += increment;
                step++;
                element.textContent = Math.floor(current);
                
                if (step >= steps) {
                    element.textContent = endValue;
                    clearInterval(timer);
                }
            }, duration / steps);
        }

        // ===== FILTERING & SEARCH =====
        function getVisibleMembers() {
            return allMembers.filter(m => m.profileVisible === true);
        }

        function getOrdinalSuffix(num) {
            const j = num % 10;
            const k = num % 100;
            if (j === 1 && k !== 11) return 'st';
            if (j === 2 && k !== 12) return 'nd';
            if (j === 3 && k !== 13) return 'rd';
            return 'th';
        }

        function showNoResults() {
            document.getElementById('membersGrid').innerHTML = '';
            document.getElementById('noResultsState').style.display = 'flex';
        }

        function resetFilters() {
            document.getElementById('memberSearch').value = '';
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.filter-tab[data-filter="all"]').classList.add('active');
            currentFilterYear = 'all';
            renderMembers();
        }

        // ===== USER ACTIONS =====
        function viewProfile(memberId) {
            alert(`Profile view for member ${memberId} - Coming soon!`);
        }

        function messageUser(memberId) {
            alert(`Messaging member ${memberId} - Coming soon!`);
        }

        // ===== CLASS LEADERS =====
        async function fetchClassLeaders() {
            try {
                const response = await fetch('/api/class-leaders');
                if (!response.ok) throw new Error('Failed to fetch');
                const data = await response.json();
                renderClassLeaders(data.classLeaders || []);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('classLeadersGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                        <i class="fas fa-info-circle" style="font-size: 2.5rem; margin-bottom: 1rem; display: block;"></i>
                        <p>No class leaders available</p>
                    </div>
                `;
            }
        }

        function renderClassLeaders(leaders) {
            const grid = document.getElementById('classLeadersGrid');
            if (leaders.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                        <i class="fas fa-info-circle" style="font-size: 2.5rem; margin-bottom: 1rem; display: block;"></i>
                        <p>No class leaders assigned yet</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = leaders.map(leader => `
                <div class="class-leader-card">
                    <div class="leader-image">
                        ${leader.imageUrl ? 
                            `<img src="${leader.imageUrl}" alt="${leader.firstName}">` :
                            `<div class="leader-avatar-placeholder"><i class="fas fa-user"></i></div>`
                        }
                    </div>
                    <h3 class="leader-name">${leader.firstName} ${leader.lastName}</h3>
                    <p class="leader-position">${leader.position || 'Class Leader'}</p>
                    <p class="leader-year"><i class="fas fa-graduation-cap"></i> Year ${leader.yearOfStudy}</p>
                </div>
            `).join('');
        }

        // ===== EVENT LISTENERS =====
        document.addEventListener('DOMContentLoaded', function() {
            // Filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilterYear = this.dataset.filter;
                    
                    const members = currentFilterYear === 'all' ? 
                        getVisibleMembers() :
                        getVisibleMembers().filter(m => m.yearOfStudy == currentFilterYear);
                    renderMembers(members);
                });
            });

            // Search input
            document.getElementById('memberSearch').addEventListener('input', function(e) {
                const term = e.target.value.toLowerCase();
                const members = getVisibleMembers().filter(m => 
                    m.firstName.toLowerCase().includes(term) ||
                    m.lastName.toLowerCase().includes(term) ||
                    (m.department || '').toLowerCase().includes(term)
                );
                renderMembers(members);
            });

            // Class leaders filter
            const classFilter = document.getElementById('classLeadersYearFilter');
            if (classFilter) {
                classFilter.addEventListener('change', async function() {
                    try {
                        const url = this.value === 'all' ? '/api/class-leaders' : `/api/class-leaders?year=${this.value}`;
                        const response = await fetch(url);
                        const data = await response.json();
                        renderClassLeaders(data.classLeaders || []);
                    } catch (error) {
                        console.error('Error:', error);
                    }
                });
            }

            // Load data
            fetchMembers();
            fetchClassLeaders();
            loadSocialMediaLinks();
        });

        // Load social media links
        async function loadSocialMediaLinks() {
            try {
                const response = await fetch('/api/admin/communication');
                const data = await response.json();
                if (data.socialMedia) {
                    const container = document.getElementById('footerSocialLinks');
                    let html = '';
                    if (data.socialMedia.facebook) html += `<a href="${data.socialMedia.facebook}" target="_blank"><i class="fab fa-facebook"></i></a>`;
                    if (data.socialMedia.twitter) html += `<a href="${data.socialMedia.twitter}" target="_blank"><i class="fab fa-twitter"></i></a>`;
                    if (data.socialMedia.instagram) html += `<a href="${data.socialMedia.instagram}" target="_blank"><i class="fab fa-instagram"></i></a>`;
                    if (data.socialMedia.linkedin) html += `<a href="${data.socialMedia.linkedin}" target="_blank"><i class="fab fa-linkedin"></i></a>`;
                    if (data.socialMedia.whatsapp) html += `<a href="${data.socialMedia.whatsapp}" target="_blank"><i class="fab fa-whatsapp"></i></a>`;
                    if (container) container.innerHTML = html;
                }
            } catch (error) {
                console.log('Social links unavailable');
            }
        }
    </script>
</body>
</html>
